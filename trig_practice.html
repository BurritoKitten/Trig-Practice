<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trig Practice</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
            background-color: #000;
            color: #fff;
        }

        .info-container {
            max-width: 600px;
            margin: 0 auto;
            text-align: left;
        }

        #app-container {
            display: none;
        }

        h1, p, button {
            color: #fff;
        }

        button {
            background-color: #61dafb;
            color: #282c35;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
        }

        button:hover {
            background-color: #4fa3d1;
        }

        #question-container {
            margin-bottom: 20px;
        }

        form {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #userAnswer {
            background-color: #000;
            color: #fff;
            padding: 10px;
            margin-bottom: 10px;
        }

        #result {
            margin-top: 10px;
            font-weight: bold;
        }

        #avgTime {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="info-container">
        <h1>Instructions</h1>
        <p>
            To input non-integer answers, use the following format:
            <br>
            - Fractions: x/y (e.g., 1/2, not 0.5)
            <br>
            - Square root: rx/y (e.g., r2/2 for the square root of 2 over 2)
        </p>
        <p>
            The available answer options are:
            <ul>
                <li>0</li>
                <li>1/2</li>
                <li>r2/2</li>
                <li>r3/2</li>
                <li>1</li>
                <li>-1/2</li>
                <li>-r2/2</li>
                <li>-r3/2</li>
                <li>-1</li>
            </ul>
        </p>
        <button onclick="startApp()">Start</button>
    </div>

    <div id="app-container">
        <h1>Trig Practice</h1>
        <div id="question-container"></div>
        <form onsubmit="checkAnswer(); return false;">
            <input type="text" id="userAnswer" placeholder="Your answer" autocomplete="off">
        </form>
        <p id="result"></p>
        <p id="avgTime">Average Time Per Question: <span id="avgTimeValue">0.0</span> seconds</p>
        <p>Current Streak: <span id="currentStreak">0</span></p>
        <p>Highest Streak: <span id="highestStreak">0</span></p>
        <button onclick="resetCounters()">Reset</button>
        <button onclick="showInstructions()">Instructions</button>
        <div id="svg-container">
            <img id="vectorImage" src="half_unit_circle_black.svg" alt="Half Unit Circle" />
        </div>
        <button id="toggleButton" onclick="toggleCoordinates()">Hide Coordinates</button>
    </div>

    <script>
        function startApp() {
            document.querySelector('.info-container').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
            generateQuestion(); // Start the app by generating the first question
        }

        var currentStreak = 0; // Counter for current streak
        var highestStreak = 0; // Counter for highest streak
        var timerActive = false;
        var startTime;
        var lastQuestionTime;
        var totalCorrectAnswers = 0;
        var totalElapsedTime = 0;

        // Function to generate a random question
        function generateQuestion() {
            var angles = [0, 30, 45, 60, 90, 120, 135, 150, 180];
            var randomAngle = angles[Math.floor(Math.random() * angles.length)];
            var isSine = Math.random() < 0.5; // 50% chance of asking for sine

            var questionText = isSine ? "sin" : "cos";
            questionText += "(" + randomAngle + ")";
            
            document.getElementById("question-container").innerHTML = "<p>" + questionText + "</p>";
            
            // Set the correct answers for each specific question
            window.correctAnswer = getCorrectAnswer(isSine, randomAngle);

            // Clear the result text
            document.getElementById("result").innerHTML = "";

            // Record the time when the question is displayed
            lastQuestionTime = new Date().getTime();
        }

        // Function to get the correct answer for a specific question
        function getCorrectAnswer(isSine, angle) {
            if (angle === 0 && isSine) return "0";
            if (angle === 90 && !isSine) return "0";
            if ((angle === 30 && isSine) || (angle === 60 && !isSine) || (angle === 150 && isSine)) return "1/2";
            if ((angle === 45 && isSine) || (angle === 45 && !isSine) || (angle === 135 && isSine)) return "r2/2";
            if ((angle === 60 && isSine) || (angle === 30 && !isSine) || (angle === 120 && isSine)) return "r3/2";
            if (angle === 90 && isSine) return "1";
            if (angle === 0 && !isSine) return "1";
            if (angle === 120 && !isSine) return "-1/2";
            if (angle === 135 && !isSine) return "-r2/2";
            if (angle === 150 && !isSine) return "-r3/2";
            if (angle === 180 && isSine) return "0"; // Corrected to "0" for sin(180)
            if (angle === 180 && !isSine) return "-1"; // Corrected to "-1" for cos(180)

            return ""; // Default, should not happen
        }

        // Function to check the user's answer
        function checkAnswer() {
            var userAnswer = document.getElementById("userAnswer").value.toLowerCase();
            
            if (isAnswerOption(userAnswer)) {
                if (userAnswer === window.correctAnswer) {
                    document.getElementById("result").innerHTML = "Correct! Well done!";
                    currentStreak++;
                    totalCorrectAnswers++;
                    document.getElementById("currentStreak").innerText = currentStreak;
                    if (currentStreak > highestStreak) {
                        highestStreak = currentStreak;
                        document.getElementById("highestStreak").innerText = highestStreak;
                    }

                    // Calculate time between question and correct answer
                    var currentTime = new Date().getTime();
                    var elapsedTime = (currentTime - lastQuestionTime) / 1000; // in seconds with 1 decimal place
                    totalElapsedTime += elapsedTime;

                    // Update average time
                    var averageTime = totalCorrectAnswers > 0 ? (totalElapsedTime / totalCorrectAnswers).toFixed(1) : 0.0;
                    document.getElementById("avgTimeValue").innerText = averageTime;

                    generateQuestion(); // Ask a new question
                } else {
                    document.getElementById("result").innerHTML = "Incorrect. Please try again.";
                    currentStreak = 0; // Reset streak if the answer is incorrect
                    document.getElementById("currentStreak").innerText = currentStreak;
                }
            } else {
                document.getElementById("result").innerHTML = "Please enter a valid answer option.";
            }

            // Clear the user's answer input
            document.getElementById("userAnswer").value = "";
        }

        // Function to check if the provided answer is one of the predefined options
        function isAnswerOption(answer) {
            var answerOptions = ["0", "1/2", "r2/2", "r3/2", "1", "-1/2", "-r2/2", "-r3/2", "-1"];
            return answerOptions.includes(answer);
        }

        // Function to reset all counters and timers
        function resetCounters() {
            currentStreak = 0;
            highestStreak = 0;
            timerActive = false;
            startTime = 0;
            lastQuestionTime = 0;
            totalCorrectAnswers = 0;
            totalElapsedTime = 0;

            document.getElementById("currentStreak").innerText = currentStreak;
            document.getElementById("highestStreak").innerText = highestStreak;
            document.getElementById("avgTimeValue").innerText = "0.0";

            generateQuestion(); // Ask a new question after reset
        }

        // Function to show instructions (take user back to the intro page)
        function showInstructions() {
            document.getElementById('app-container').style.display = 'none';
            document.querySelector('.info-container').style.display = 'block';
        }

        function toggleCoordinates() {
            var image = document.getElementById('vectorImage');
            var toggleButton = document.getElementById('toggleButton');

            // Toggle between two SVGs
            if (image.src.includes('half_unit_circle_black.svg')) {
                image.src = 'half_unit_circle_black_no_coords.svg';
                toggleButton.textContent = 'Show Coordinates';
            } else {
                image.src = 'half_unit_circle_black.svg';
                toggleButton.textContent = 'Hide Coordinates';
            }
        }
        
    </script>
</body>
</html>
